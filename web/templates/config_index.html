<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Config Editor</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1>Config Editor</h1>
        <ul class="nav nav-tabs" id="configTabs"></ul>
        <div class="tab-content" id="tabContent"></div>
        <button id="addRow" class="btn btn-success mt-3">Add Parameter</button>
        <button id="saveConfig" class="btn btn-primary mt-3">Save Config</button>
    </div>

    <script>
        const configData = JSON.parse('{{ config | tojson | safe }}');
    
        //const configData = JSON.parse('{{ config | safe }}');

        $(document).ready(function() {
            // Populate tabs and content
            Object.keys(configData).forEach((section, index) => {
                $('#configTabs').append(`
                    <li class="nav-item">
                        <a class="nav-link ${index === 0 ? 'active' : ''}" data-bs-toggle="tab" href="#tab-${section}">${section}</a>
                    </li>
                `);

                const rows = Object.entries(configData[section]).map(([key, value]) => `
                    <tr>
                        <td><input type="text" class="form-control param-name" value="${key}" /></td>
                        <td><input type="text" class="form-control param-value" value="${value}" /></td>
                        <td><button class="btn btn-danger btn-sm delete-row">Delete</button></td>
                    </tr>
                `).join('');

                $('#tabContent').append(`
                    <div class="tab-pane fade ${index === 0 ? 'show active' : ''}" id="tab-${section}">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Parameter</th>
                                    <th>Value</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rows}
                            </tbody>
                        </table>
                    </div>
                `);
            });

            // Add row functionality
            $('#addRow').click(function() {
                const activeSection = $('.tab-pane.active');
                activeSection.find('tbody').append(`
                    <tr>
                        <td><input type="text" class="form-control param-name" value="" /></td>
                        <td><input type="text" class="form-control param-value" value="" /></td>
                        <td><button class="btn btn-danger btn-sm delete-row">Delete</button></td>
                    </tr>
                `);
            });

            // Delete row functionality
            $(document).on('click', '.delete-row', function() {
                $(this).closest('tr').remove();
            });

            // Save config functionality
            $('#saveConfig').click(function() {
                const updatedConfig = {};

                $('.tab-pane').each(function() {
                    const section = $(this).attr('id').replace('tab-', '');
                    const rows = $(this).find('tbody tr');
                    updatedConfig[section] = {};

                    rows.each(function() {
                        const key = $(this).find('.param-name').val();
                        const value = $(this).find('.param-value').val();
                        if (key) updatedConfig[section][key] = value;
                    });
                });

                $.ajax({
                    url: '/config/save',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(updatedConfig),
                    success: function(response) {
                        alert('Config saved successfully!');
                    },
                    error: function(error) {
                        alert('Failed to save config.');
                    }
                });
            });
        });
    </script>
</body>
</html>
